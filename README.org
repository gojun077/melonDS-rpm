#+TITLE: melonDS-rpm
#+SUBTITLE: rpmbuild spec files, scripts for Fedora COPR melonDS build
#+AUTHOR: Peter Jun Koh
#+EMAIL: gopeterjun@naver.com
#+DESCRIPTION:
#+KEYWORDS: linux, rhel, rpm, packaging, spec, fedora, copr
#+LANGUAGE: en

* Summary

- Created on: [2025-11-15 Sat]
- Last Updated: [2025-11-26 Wed 23:39]

[[https://copr.fedorainfracloud.org/coprs/archjun/melonDS/package/melonDS/][[[https://copr.fedorainfracloud.org/coprs/archjun/melonDS/package/melonDS/status_image/last_build.png]]][build status]]

This repo contains ~rpm~ package-related config files necessary to package
the open-source =melonDS= Nintendo DS emulator build from C/CPP source.

The resulting ~rpm~ packages are also built by the Fedora COPR build
system for Fedora user-submitted packages in the following project:

https://copr.fedorainfracloud.org/coprs/archjun/melonDS/

* Topics

** How to build melonDS rpm package from this repo

First you need to install packages necessary for =rpmbuild=. Assuming you
are on Fedora:

#+begin_src sh
  sudo dnf install fedora-packager \
    fedora-review \
    mock \
    rpmdevtools \
    rpmlint
#+end_src

Then add your user to the ~mock~ group:

#+begin_src sh
  sudo usermod -a -G mock $USER
#+end_src

Finally, install the build dependencies for =melonDS= itself:

#+begin_src sh
  sudo dnf install SDL2-devel \
    enet-devel \
    extra-cmake-modules \
    libarchive-devel \
    qt6-qtbase-devel \
    qt6-qtbase-private-devel \
    qt6-qtmultimedia-devel \
    qt6-qtsvg-devel \
    wayland-devel
#+end_src

Now from the project root, run =make build= which will generate the
~rpmbuild~ folder structure:

#+begin_src sh :noeval
  $ tree -d
  .
  ├── BUILD
  ├── RPMS
  ├── SOURCES
  ├── SPECS
  └── SRPMS
#+end_src

The =make build= recipe will also read ~SPECS/melonDS.spec~ for how to
build from C/CPP source using =cmake=.

Note that default upstream https://github.com/melonDS-emu/melonDS strips
out debug info when building from source with =cmake=. However, in this
repo, the ~melonDS.spec~ specifies that debug headers not be stripped
with the following =cmake= options:

#+begin_src cmake
  -DCMAKE_BUILD_TYPE=RelWithDebInfo \
  -DCMAKE_INSTALL_DO_STRIP=OFF \
#+end_src

Once the build is complete, the ~.rpm~ build artifacts can be found in
~RPMS/{aarch64,x86_64}/~ and the source rpm's can be found in
~SRPMS/~.
